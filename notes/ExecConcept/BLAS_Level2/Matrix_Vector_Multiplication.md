# Matrix-Vector Multiplication Note

BLASEngineは行列-ベクトル積C=ABをサポートしています。個の演算は行列積について行列Bをベクトルとしたときの演算に相当します。

この行列演算をBLASEngine上で実装する方法は二つあります。

#### 方法1：AとBを固定

行列AとベクトルBの要素は各レーンで固定した配置とします。乗算結果をネットワークを通して適切なレーンへローテートを通して転送し転送先レーンで累和に使用します。これはシストリックアレイ演算に相当します。この演算は三項演算（MAD）を前提とします。


#### 方法2：AとBをローテート

要素aの列方向にレーンをマップします。
行列AとベクトルBの要素をレジスタファイルから読み出し、ネットワークでローテートを行い、適宜転送先レーンの乗算でも使用しデータを再利用します。各レーンは一つの内積演算を実施して行列演算結果の要素cを得ます。この演算も三項演算（MAD）を前提とします。


#### 多次元並列処理

上記の方法は図の例で3つのレーンを利用して演算しています。これを9個のレーンを使用して行列の二次元をレーンに展開して上記の要領で演算することで二次元シストリックアレイでの行列積と同等の性能を実現できます。


#### BLASEngineのメリット

各レーンにある入力ベクトルの部分ベクトルを再配置する必要がなくなり、例えば次の演算において現在の演算結果ベクトルの各要素を各レーンへ再配置することを不要としてベクトル演算ユニットの演算器は演算のみに集中でき、無駄な処理を削減します。