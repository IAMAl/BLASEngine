# Matrix-Matrix Multiplication Note

BLASEngineは行列積C=ABをサポートしています。下図は披乗算行列Aの要素aと乗算側行列Bの要素bの間の対応を示しています。左に行列Bの要素、右に行列Aの要素が位置しています。要素bは各タイミングで要素aと合流して乗算を行い、類話を下方向へ転送します。類話の方法は二つあります。一つは乗算の後に列方向から受け取ったデータとで加算を行い結果を転送して出力団で内積結果の要素ｃを得る方法です。もう一つは乗算結果をそのまま転送して各列の出力段にアキュムレータ（累和器）を設けておいてそこで累和を行い内積結果の要素ｃを得る方法です。


<div align="center">
  <img src="https://github.com/IAMAl/BLASEngine/blob/main/notes/ExecConcept/MatMatMult.png"
       alt="HTML image alt text"
       title="Matrix-Matrix Multiplication"
       width="700px"
  />
</div>


この行列演算をBLAS上で実装する方法は二つあります。

#### 方法1：AとBを固定

乗算結果をネットワークを通して適切なレーンへ転送し転送先レーンで累和に使用します。これはシストリックアレイ演算に相当します。転地したＢの場合結果の行列Ｃも転地した配置で得ます。この演算では三項演算（MAD）を前提とします。


#### 方法2：AとBをローテート

行列Ａと行列Ｂの要素をレジスタファイルから読み出し、ネットワークでローテートを行い、適宜転送先レーンの乗算でも使用しデータを再利用します。各レーンは一つの内積演算を実施して行列演算結果の要素ｃを得ます。この演算も三項演算（MAD）を前提とします。


#### BLASEngineのメリット

各レーンにある入力ベクトルの部分ベクトルを再配置する必要がなくなり、たとえな次の演算において演算結果ベクトルの各要素について各レーンへの再配置を不要としてベクトル演算ユニットの演算器は演算のみに集中できます。